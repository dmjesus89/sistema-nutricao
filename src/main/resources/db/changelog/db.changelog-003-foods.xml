<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                   http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.1.xsd">

    <!-- Create Foods Table -->
    <changeSet id="010-create-foods-table" author="nutrition-system">
        <createTable tableName="foods">
            <column name="id" type="BIGSERIAL">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="name" type="VARCHAR(200)">
                <constraints nullable="false"/>
            </column>
            <column name="description" type="VARCHAR(1000)"/>
            <column name="brand" type="VARCHAR(100)"/>
            <column name="category" type="VARCHAR(50)">
                <constraints nullable="false"/>
            </column>
            <column name="barcode" type="VARCHAR(50)"/>
            <column name="calories_per_100g" type="DECIMAL(8,2)">
                <constraints nullable="false"/>
            </column>
            <column name="carbs_per_100g" type="DECIMAL(6,2)">
                <constraints nullable="false"/>
            </column>
            <column name="protein_per_100g" type="DECIMAL(6,2)">
                <constraints nullable="false"/>
            </column>
            <column name="fat_per_100g" type="DECIMAL(6,2)">
                <constraints nullable="false"/>
            </column>
            <column name="fiber_per_100g" type="DECIMAL(6,2)"/>
            <column name="sugar_per_100g" type="DECIMAL(6,2)"/>
            <column name="sodium_per_100g" type="DECIMAL(8,2)"/>
            <column name="saturated_fat_per_100g" type="DECIMAL(6,2)"/>
            <column name="serving_size" type="DECIMAL(6,2)"/>
            <column name="serving_description" type="VARCHAR(100)"/>
            <column name="source" type="VARCHAR(100)"/>
            <column name="verified" type="BOOLEAN" defaultValue="false">
                <constraints nullable="false"/>
            </column>
            <column name="active" type="BOOLEAN" defaultValue="true">
                <constraints nullable="false"/>
            </column>
            <column name="created_by_user_id" type="BIGINT"/>
            <column name="created_at" type="TIMESTAMP" defaultValueComputed="CURRENT_TIMESTAMP">
                <constraints nullable="false"/>
            </column>
            <column name="updated_at" type="TIMESTAMP"/>
        </createTable>

        <addForeignKeyConstraint baseTableName="foods"
                                 baseColumnNames="created_by_user_id"
                                 constraintName="fk_foods_created_by"
                                 referencedTableName="users"
                                 referencedColumnNames="id"
                                 onDelete="SET NULL"/>

        <addUniqueConstraint tableName="foods"
                             columnNames="barcode"
                             constraintName="uk_foods_barcode"/>

        <createIndex indexName="idx_foods_name" tableName="foods">
            <column name="name"/>
        </createIndex>

        <createIndex indexName="idx_foods_category" tableName="foods">
            <column name="category"/>
        </createIndex>

        <createIndex indexName="idx_foods_brand" tableName="foods">
            <column name="brand"/>
        </createIndex>

        <createIndex indexName="idx_foods_verified_active" tableName="foods">
            <column name="verified"/>
            <column name="active"/>
        </createIndex>

        <createIndex indexName="idx_foods_barcode" tableName="foods">
            <column name="barcode"/>
        </createIndex>
    </changeSet>

    <!-- Create Supplements Table -->
    <changeSet id="011-create-supplements-table" author="nutrition-system">
        <createTable tableName="supplements">
            <column name="id" type="BIGSERIAL">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="name" type="VARCHAR(200)">
                <constraints nullable="false"/>
            </column>
            <column name="description" type="VARCHAR(1000)"/>
            <column name="brand" type="VARCHAR(100)"/>
            <column name="category" type="VARCHAR(50)">
                <constraints nullable="false"/>
            </column>
            <column name="form" type="VARCHAR(20)">
                <constraints nullable="false"/>
            </column>
            <column name="serving_size" type="DECIMAL(8,2)">
                <constraints nullable="false"/>
            </column>
            <column name="serving_unit" type="VARCHAR(20)">
                <constraints nullable="false"/>
            </column>
            <column name="servings_per_container" type="DECIMAL(6,0)"/>
            <column name="calories_per_serving" type="DECIMAL(6,2)"/>
            <column name="carbs_per_serving" type="DECIMAL(6,2)"/>
            <column name="protein_per_serving" type="DECIMAL(6,2)"/>
            <column name="fat_per_serving" type="DECIMAL(6,2)"/>
            <column name="main_ingredient" type="VARCHAR(200)"/>
            <column name="ingredient_amount" type="DECIMAL(10,2)"/>
            <column name="ingredient_unit" type="VARCHAR(20)"/>
            <column name="recommended_dosage" type="VARCHAR(500)"/>
            <column name="usage_instructions" type="VARCHAR(1000)"/>
            <column name="warnings" type="VARCHAR(1000)"/>
            <column name="regulatory_info" type="VARCHAR(500)"/>
            <column name="verified" type="BOOLEAN" defaultValue="false">
                <constraints nullable="false"/>
            </column>
            <column name="active" type="BOOLEAN" defaultValue="true">
                <constraints nullable="false"/>
            </column>
            <column name="created_by_user_id" type="BIGINT"/>
            <column name="created_at" type="TIMESTAMP" defaultValueComputed="CURRENT_TIMESTAMP">
                <constraints nullable="false"/>
            </column>
            <column name="updated_at" type="TIMESTAMP"/>
        </createTable>

        <addForeignKeyConstraint baseTableName="supplements"
                                 baseColumnNames="created_by_user_id"
                                 constraintName="fk_supplements_created_by"
                                 referencedTableName="users"
                                 referencedColumnNames="id"
                                 onDelete="SET NULL"/>

        <createIndex indexName="idx_supplements_name" tableName="supplements">
            <column name="name"/>
        </createIndex>

        <createIndex indexName="idx_supplements_category" tableName="supplements">
            <column name="category"/>
        </createIndex>

        <createIndex indexName="idx_supplements_brand" tableName="supplements">
            <column name="brand"/>
        </createIndex>

        <createIndex indexName="idx_supplements_verified_active" tableName="supplements">
            <column name="verified"/>
            <column name="active"/>
        </createIndex>
    </changeSet>

    <!-- Create User Food Preferences Table -->
    <changeSet id="012-create-user-food-preferences-table" author="nutrition-system">
        <createTable tableName="user_food_preferences">
            <column name="id" type="BIGSERIAL">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="user_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="food_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="preference_type" type="VARCHAR(20)">
                <constraints nullable="false"/>
            </column>
            <column name="notes" type="VARCHAR(500)"/>
            <column name="created_at" type="TIMESTAMP" defaultValueComputed="CURRENT_TIMESTAMP">
                <constraints nullable="false"/>
            </column>
            <column name="updated_at" type="TIMESTAMP"/>
        </createTable>

        <addForeignKeyConstraint baseTableName="user_food_preferences"
                                 baseColumnNames="user_id"
                                 constraintName="fk_user_food_preferences_user"
                                 referencedTableName="users"
                                 referencedColumnNames="id"
                                 onDelete="CASCADE"/>

        <addForeignKeyConstraint baseTableName="user_food_preferences"
                                 baseColumnNames="food_id"
                                 constraintName="fk_user_food_preferences_food"
                                 referencedTableName="foods"
                                 referencedColumnNames="id"
                                 onDelete="CASCADE"/>

        <addUniqueConstraint tableName="user_food_preferences"
                             columnNames="user_id, food_id"
                             constraintName="uk_user_food_preferences"/>

        <createIndex indexName="idx_user_food_preferences_user_type" tableName="user_food_preferences">
            <column name="user_id"/>
            <column name="preference_type"/>
        </createIndex>
    </changeSet>

    <!-- Create User Supplement Preferences Table -->
    <changeSet id="013-create-user-supplement-preferences-table" author="nutrition-system">
        <createTable tableName="user_supplement_preferences">
            <column name="id" type="BIGSERIAL">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="user_id" type="BIGSERIAL">
                <constraints nullable="false"/>
            </column>
            <column name="supplement_id" type="BIGSERIAL">
                <constraints nullable="false"/>
            </column>
            <column name="preference_type" type="VARCHAR(20)">
                <constraints nullable="false"/>
            </column>
            <column name="notes" type="VARCHAR(500)"/>
            <column name="created_at" type="TIMESTAMP" defaultValueComputed="CURRENT_TIMESTAMP">
                <constraints nullable="false"/>
            </column>
            <column name="updated_at" type="TIMESTAMP"/>
        </createTable>

        <addForeignKeyConstraint baseTableName="user_supplement_preferences"
                                 baseColumnNames="user_id"
                                 constraintName="fk_user_supplement_preferences_user"
                                 referencedTableName="users"
                                 referencedColumnNames="id"
                                 onDelete="CASCADE"/>

        <addForeignKeyConstraint baseTableName="user_supplement_preferences"
                                 baseColumnNames="supplement_id"
                                 constraintName="fk_user_supplement_preferences_supplement"
                                 referencedTableName="supplements"
                                 referencedColumnNames="id"
                                 onDelete="CASCADE"/>

        <addUniqueConstraint tableName="user_supplement_preferences"
                             columnNames="user_id, supplement_id"
                             constraintName="uk_user_supplement_preferences"/>

        <createIndex indexName="idx_user_supplement_preferences_user_type" tableName="user_supplement_preferences">
            <column name="user_id"/>
            <column name="preference_type"/>
        </createIndex>
    </changeSet>

    <!-- Create User Dietary Restrictions Table -->
    <changeSet id="014-create-user-dietary-restrictions-table" author="nutrition-system">
        <createTable tableName="user_dietary_restrictions">
            <column name="id" type="BIGSERIAL">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="user_id" type="BIGSERIAL">
                <constraints nullable="false"/>
            </column>
            <column name="restriction_type" type="VARCHAR(30)">
                <constraints nullable="false"/>
            </column>
            <column name="severity" type="VARCHAR(20)" defaultValue="MODERATE">
                <constraints nullable="false"/>
            </column>
            <column name="notes" type="VARCHAR(500)"/>
            <column name="active" type="BOOLEAN" defaultValue="true">
                <constraints nullable="false"/>
            </column>
            <column name="created_at" type="TIMESTAMP" defaultValueComputed="CURRENT_TIMESTAMP">
                <constraints nullable="false"/>
            </column>
            <column name="updated_at" type="TIMESTAMP"/>
        </createTable>

        <addForeignKeyConstraint baseTableName="user_dietary_restrictions"
                                 baseColumnNames="user_id"
                                 constraintName="fk_user_dietary_restrictions_user"
                                 referencedTableName="users"
                                 referencedColumnNames="id"
                                 onDelete="CASCADE"/>

        <createIndex indexName="idx_user_dietary_restrictions_user_active" tableName="user_dietary_restrictions">
            <column name="user_id"/>
            <column name="active"/>
        </createIndex>
    </changeSet>





    <!-- Sample Foods Data -->
    <changeSet id="019-insert-sample-foods" author="nutrition-system" context="dev">
        <comment>Sample food data for development and testing</comment>

        <!-- Frutas -->
        <insert tableName="foods">
            <column name="name" value="Maçã"/>
            <column name="description" value="Maçã fresca, fonte de fibras e vitaminas"/>
            <column name="category" value="FRUITS"/>
            <column name="calories_per_100g" value="52"/>
            <column name="carbs_per_100g" value="14"/>
            <column name="protein_per_100g" value="0.3"/>
            <column name="fat_per_100g" value="0.2"/>
            <column name="fiber_per_100g" value="2.4"/>
            <column name="sugar_per_100g" value="10.4"/>
            <column name="serving_size" value="150"/>
            <column name="serving_description" value="1 unidade média"/>
            <column name="source" value="TACO"/>
            <column name="verified" value="true"/>
            <column name="active" value="true"/>
        </insert>

        <insert tableName="foods">
            <column name="name" value="Banana"/>
            <column name="description" value="Banana prata, rica em potássio"/>
            <column name="category" value="FRUITS"/>
            <column name="calories_per_100g" value="89"/>
            <column name="carbs_per_100g" value="23"/>
            <column name="protein_per_100g" value="1.1"/>
            <column name="fat_per_100g" value="0.3"/>
            <column name="fiber_per_100g" value="2.6"/>
            <column name="sugar_per_100g" value="12"/>
            <column name="serving_size" value="120"/>
            <column name="serving_description" value="1 unidade média"/>
            <column name="source" value="TACO"/>
            <column name="verified" value="true"/>
        </insert>

        <!-- Proteínas -->
        <insert tableName="foods">
            <column name="name" value="Peito de Frango"/>
            <column name="description" value="Peito de frango sem pele, grelhado"/>
            <column name="category" value="PROTEINS"/>
            <column name="calories_per_100g" value="165"/>
            <column name="carbs_per_100g" value="0"/>
            <column name="protein_per_100g" value="31"/>
            <column name="fat_per_100g" value="3.6"/>
            <column name="fiber_per_100g" value="0"/>
            <column name="sodium_per_100g" value="74"/>
            <column name="serving_size" value="100"/>
            <column name="serving_description" value="1 filé médio"/>
            <column name="source" value="USDA"/>
            <column name="verified" value="true"/>
        </insert>

        <insert tableName="foods">
            <column name="name" value="Ovos"/>
            <column name="description" value="Ovo de galinha inteiro, cozido"/>
            <column name="category" value="PROTEINS"/>
            <column name="calories_per_100g" value="155"/>
            <column name="carbs_per_100g" value="1.1"/>
            <column name="protein_per_100g" value="13"/>
            <column name="fat_per_100g" value="11"/>
            <column name="fiber_per_100g" value="0"/>
            <column name="sodium_per_100g" value="124"/>
            <column name="serving_size" value="50"/>
            <column name="serving_description" value="1 unidade média"/>
            <column name="source" value="TACO"/>
            <column name="verified" value="true"/>
        </insert>

        <!-- Cereais e Grãos -->
        <insert tableName="foods">
            <column name="name" value="Arroz Integral"/>
            <column name="description" value="Arroz integral cozido"/>
            <column name="category" value="CEREALS_GRAINS"/>
            <column name="calories_per_100g" value="123"/>
            <column name="carbs_per_100g" value="25"/>
            <column name="protein_per_100g" value="2.6"/>
            <column name="fat_per_100g" value="1"/>
            <column name="fiber_per_100g" value="1.8"/>
            <column name="sodium_per_100g" value="4"/>
            <column name="serving_size" value="150"/>
            <column name="serving_description" value="1 xícara"/>
            <column name="source" value="TACO"/>
            <column name="verified" value="true"/>
        </insert>

        <insert tableName="foods">
            <column name="name" value="Aveia"/>
            <column name="description" value="Aveia em flocos"/>
            <column name="category" value="CEREALS_GRAINS"/>
            <column name="calories_per_100g" value="389"/>
            <column name="carbs_per_100g" value="66"/>
            <column name="protein_per_100g" value="17"/>
            <column name="fat_per_100g" value="7"/>
            <column name="fiber_per_100g" value="10"/>
            <column name="sodium_per_100g" value="2"/>
            <column name="serving_size" value="40"/>
            <column name="serving_description" value="4 colheres de sopa"/>
            <column name="source" value="TACO"/>
            <column name="verified" value="true"/>
        </insert>

        <!-- Vegetais -->
        <insert tableName="foods">
            <column name="name" value="Brócolis"/>
            <column name="description" value="Brócolis cozido no vapor"/>
            <column name="category" value="VEGETABLES"/>
            <column name="calories_per_100g" value="34"/>
            <column name="carbs_per_100g" value="7"/>
            <column name="protein_per_100g" value="2.8"/>
            <column name="fat_per_100g" value="0.4"/>
            <column name="fiber_per_100g" value="2.6"/>
            <column name="sodium_per_100g" value="33"/>
            <column name="serving_size" value="100"/>
            <column name="serving_description" value="1 xícara"/>
            <column name="source" value="USDA"/>
            <column name="verified" value="true"/>
        </insert>

        <!-- Laticínios -->
        <insert tableName="foods">
            <column name="name" value="Iogurte Natural"/>
            <column name="description" value="Iogurte natural integral"/>
            <column name="category" value="DAIRY"/>
            <column name="calories_per_100g" value="61"/>
            <column name="carbs_per_100g" value="4.7"/>
            <column name="protein_per_100g" value="3.5"/>
            <column name="fat_per_100g" value="3.3"/>
            <column name="fiber_per_100g" value="0"/>
            <column name="sodium_per_100g" value="46"/>
            <column name="serving_size" value="170"/>
            <column name="serving_description" value="1 pote"/>
            <column name="source" value="TACO"/>
            <column name="verified" value="true"/>
        </insert>
    </changeSet>

    <!-- Sample Supplements Data -->
    <changeSet id="020-insert-sample-supplements" author="nutrition-system" context="dev">
        <comment>Sample supplement data for development and testing</comment>

        <!-- Proteínas -->
        <insert tableName="supplements">
            <column name="name" value="Whey Protein Concentrado"/>
            <column name="description" value="Proteína concentrada do soro do leite"/>
            <column name="brand" value="Optimum Nutrition"/>
            <column name="category" value="PROTEIN"/>
            <column name="form" value="POWDER"/>
            <column name="serving_size" value="30"/>
            <column name="serving_unit" value="GRAMS"/>
            <column name="servings_per_container" value="74"/>
            <column name="calories_per_serving" value="120"/>
            <column name="carbs_per_serving" value="3"/>
            <column name="protein_per_serving" value="24"/>
            <column name="fat_per_serving" value="1"/>
            <column name="main_ingredient" value="Whey Protein Concentrate"/>
            <column name="ingredient_amount" value="24"/>
            <column name="ingredient_unit" value="g"/>
            <column name="recommended_dosage" value="1 scoop (30g) com 200ml de água"/>
            <column name="usage_instructions" value="Consumir após o treino ou entre as refeições"/>
            <column name="verified" value="true"/>
        </insert>

        <!-- Vitaminas -->
        <insert tableName="supplements">
            <column name="name" value="Vitamina D3"/>
            <column name="description" value="Vitamina D3 (colecalciferol)"/>
            <column name="category" value="VITAMINS"/>
            <column name="form" value="SOFTGEL"/>
            <column name="serving_size" value="1"/>
            <column name="serving_unit" value="CAPSULES"/>
            <column name="servings_per_container" value="60"/>
            <column name="main_ingredient" value="Vitamina D3"/>
            <column name="ingredient_amount" value="2000"/>
            <column name="ingredient_unit" value="IU"/>
            <column name="recommended_dosage" value="1 cápsula ao dia"/>
            <column name="usage_instructions" value="Tomar com uma refeição contendo gordura"/>
            <column name="verified" value="true"/>
        </insert>

        <!-- Creatina -->
        <insert tableName="supplements">
            <column name="name" value="Creatina Monohidrato"/>
            <column name="description" value="Creatina monohidrato pura"/>
            <column name="category" value="CREATINE"/>
            <column name="form" value="POWDER"/>
            <column name="serving_size" value="3"/>
            <column name="serving_unit" value="GRAMS"/>
            <column name="servings_per_container" value="100"/>
            <column name="main_ingredient" value="Creatine Monohydrate"/>
            <column name="ingredient_amount" value="3"/>
            <column name="ingredient_unit" value="g"/>
            <column name="recommended_dosage" value="3g ao dia"/>
            <column name="usage_instructions" value="Pode ser consumida a qualquer momento do dia"/>
            <column name="verified" value="true"/>
        </insert>

        <!-- Ômega 3 -->
        <insert tableName="supplements">
            <column name="name" value="Ômega 3"/>
            <column name="description" value="Óleo de peixe concentrado EPA/DHA"/>
            <column name="category" value="OMEGA3"/>
            <column name="form" value="SOFTGEL"/>
            <column name="serving_size" value="2"/>
            <column name="serving_unit" value="CAPSULES"/>
            <column name="servings_per_container" value="60"/>
            <column name="calories_per_serving" value="20"/>
            <column name="fat_per_serving" value="2"/>
            <column name="main_ingredient" value="EPA + DHA"/>
            <column name="ingredient_amount" value="1000"/>
            <column name="ingredient_unit" value="mg"/>
            <column name="recommended_dosage" value="2 cápsulas ao dia"/>
            <column name="usage_instructions" value="Tomar com as refeições"/>
            <column name="verified" value="true"/>
        </insert>
    </changeSet>

</databaseChangeLog>